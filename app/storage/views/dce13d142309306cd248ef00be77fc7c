<html>
  <head>
    <link rel="stylesheet" type="text/css" href="<?php echo asset('bootstrap/css/bootstrap.min.css'); ?>">
    <link rel="stylesheet" type="text/css" href="<?php echo asset('bootstrap/css/custom.css'); ?>">
    <script src="<?php echo asset('bootstrap/jquery/jquery-2.1.1.min.js'); ?>"></script>
    
  </head>

  <style type="text/css">
  

  

  
  </style>

  <body class="container-fluid">
    <div class="topHeading">
      <?php echo $__env->make('general/header', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>    
      <div class="row menuOption">
        <div class="col-md-3 hidden-sm hidden-xs"></div>
        <div class="col-md-9">
          <ul class="nav nav-pills nav-justified">
            <li><a href="<?php echo URL::route('welcome'); ?>">Home</a></li>
            <li><a href="<?php echo URL::route('homeCar'); ?>">Cars</a></li>
            <li><a href="<?php echo URL::route('homeOwners'); ?>">Owners</a></li>
            <li  class="active"  ><a href="<?php echo URL::route('homeAccidents'); ?>">Accidents</a></li>
            <li><a href="<?php echo URL::route('homeReports'); ?>">Reports</a></li>
            <li><a href="<?php echo URL::route('homeAccounts'); ?>">Accounts</a></li>
          </ul>
        </div>
      </div>
    </div>

<!--    <br><br><br><br><br><br><br>
 -->
  <div class="flush"></div>
    <!-- this is the body of the whole idb -->    
    <center><div class="bbody ">
      <div class="shortInfo row"  >
        <div class="col-md-3 col-sm-3 hidden-xs sidebar">
          <?php echo $__env->make('general/sideBar', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
        </div>
        <div class="col-md-9 col-sm-9" >
          <div class="row" >
            <center>
              <h2>Accident Management Module</h2>
              <p>
                Record all what is happening in a orderly manner
              </p>
            </center>
          </div>
          <a href="#recordAccidentForm" class="inline" > Record New wAccident </a> 
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          <a href="#addParticipantForm" class="inline" > Add New Participant </a>


          <?php if(Session::has('success')): ?>
              <ul class="list-group" style="color: green;">
                <li class="list-group-item list-group-success">
                  <?php echo Session::get('success');; ?> 
                </li>
            </ul>
            <?php endif; ?>

            <?php if($errors->any()): ?>
            <ul class="lastError">
              <?php echo implode('', $errors->all('<li class="error">:message</li>')); ?>

            </ul>
            <?php endif; ?>
          
          </p><br>

          <?php if($accidents->count()): ?>
            <table class="table table-striped table-bordered table table-hover reportTable">
                <thead>
                <tr>
                    <th>Report No</th>
                    <th>Location</th>
                    <th>Date</th>
                    <th>Regno || driver Id || damage cost</th>
                    <th>Edit</th>
                    <th>Delete</th>
                </tr>
                </thead>

                <tbody>
                <?php foreach($accidents as $acc => $accident): ?>
                <tr>
                  <td><?php echo $accident->reportNumber; ?></td>
                  <td><?php echo $accident->location; ?></td>
                  <td><?php echo $accident->date; ?></td>
                  
                  <td>
                    <?php foreach($participants as $part => $participant): ?>
                      <?php if($accident->reportNumber == $participant->reportNumber): ?>
                        <?php echo $participant->regno; ?> || 
                        <?php echo $participant->driver_id; ?> || 
                        <?php echo $participant->damage_amount; ?>frs &nbsp;&nbsp; 
                        <!-- code to edit the amount for a particular car and driver and involved in a particular accident -->
                           <?php echo "<a href='".
                            url("accidents/edit/participants/{$accident->reportNumber}/{$participant->regno}")."'><em>Unlink</em></a>"; ?>
                        <br>
                      <?php endif; ?>
                    <?php endforeach; ?>
                </td>
                   
                  <td>
                    <?php echo Form::open(array('route' => array('editAccident', $accident->reportNumber))); ?>

                    
                      <?php echo Form::submit('Update', array('class' => 'btn btn-primary')); ?>

                    
                    <?php echo Form::close(); ?>


                  <td>
                    <?php echo Form::open(array('route' => array('deleteAccident', $accident->reportNumber))); ?>

                        
                      <?php echo Form::submit('Delete', array('class' => 'btn btn-danger')); ?>

<!--                       <input type="submit" name="submit" value="submit  33" class="btn btn-danger inline" onclick="return validateInputs()">
 -->
                    <?php echo Form::close(); ?>

                  </td>
                </tr>
                <?php endforeach; ?>
                </tbody>
            </table>
            <?php else: ?>
            <strong>No accidents for far</strong>
            <?php endif; ?>

        </div>
      </div>

    </div></center>
    <?php echo $__env->make('general/footer', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
    <script src="<?php echo asset('bootstrap/js/respond.js'); ?>"></script>
    
    <script src="<?php echo asset('bootstrap/js/bootstrap.min.js'); ?>"></script>

    <div style="display:none;">
      <div id="recordAccidentForm" class="addFormDiv">
          <h3><em>Record New Accident</em></h3>
          <?php echo Form::open(array('route' => 'recordAccident')); ?>



              <input type="text" name="regno" placeholder="Car Registration Number" list="regnoList"/><br>
              <datalist id="regnoList">
                <?php foreach($regnoList as $reg): ?>
              	<option value="<?php echo $reg->regno; ?>"> <?php echo $reg->regno; ?> </option>
              	<?php endforeach; ?>
              </datalist>

              <input type="text" name="driver_id" placeholder="Driver's Id" list="driver_idList" ><br>
              <datalist id="driver_idList">
                <?php foreach($driver_idList as $driver): ?>
                <option value="<?php echo $driver->driver_id; ?>"> <?php echo $driver->name; ?> </option>
                <?php endforeach; ?>
              </datalist>

              <input type="date" name="date" placeholder="Date of Accident"><br><br>
              <input type="number" name="damage_amount" placeholder="Damage Amount"><br><br>
              <input type="text" name="location" placeholder="Location of accident"><br><br>
              <button type="submit" name="createUserSubmit" onclick="return validateInputs()"
             value="save" class="submitt">Record</button>
          <?php echo Form::close(); ?>

      </div>
    </div>

    <div style="display:none;">
      <div id="addParticipantForm" class="addFormDiv">
          <h3><em>Add Accident Participant</em></h3>
          <?php echo Form::open(array('route' => 'addAccidentParticipant')); ?>



              <input type="text" name="reportNumber" placeholder="Report Number" list="reportNumber"/><br>
              <datalist id="reportNumber">
                <?php foreach($accidents as $acc => $accident): ?>
                <option value="<?php echo $accident->reportNumber; ?>"> <?php echo $accident->reportNumber; ?> </option>
                <?php endforeach; ?>
              </datalist>

              <input type="text" name="regno" placeholder="Car Registration Number" list="regnoList"/><br>
              <datalist id="regnoList">
                <?php foreach($regnoList as $reg): ?>
                <option value="<?php echo $reg->regno; ?>"> <?php echo $reg->regno; ?> </option>
                <?php endforeach; ?>
              </datalist>

              <input type="text" name="driver_id" placeholder="Driver's Id" list="driver_idList" ><br>
              <datalist id="driver_idList">
                <?php foreach($driver_idList as $driver): ?>
                <option value="<?php echo $driver->driver_id; ?>"> <?php echo $driver->name; ?> </option>
                <?php endforeach; ?>
              </datalist>

              <input type="number" name="damage_amount" placeholder="Damage Amount"><br><br>
              <br><br>
              <button type="submit" name="createUserSubmit" onclick="return validateInputs()"
             value="save" class="submitt"> Add </button>
          <?php echo Form::close(); ?>

      </div>
    </div>



  </body>
</html>
